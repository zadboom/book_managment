<!DOCTYPE html>
<html lang="fa" dir="rtl" class="rtl">

<head>
  <meta charset="UTF-8">
  <title>ğŸ“š Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">

  <!-- Ù†Ù…Ø§ÛŒØ´ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø®Ø±ÙˆØ¬ -->
  {% if request.user.is_authenticated %}
    <div class="flex justify-end items-center gap-4 mb-6">
      <span class="font-bold text-gray-700">{{ request.user.username }}</span>
      <a href="{% url 'logout' %}" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">Ø®Ø±ÙˆØ¬</a>
    </div>
  {% endif %}

  <!-- Ø¹Ù†ÙˆØ§Ù† -->
  <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">ğŸ“š Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†</h1>

  <!-- Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨ -->
  <div class="text-center mb-6">
    <a href="{% url 'add_book' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg shadow-md">
      â• Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯
    </a>
  </div>

  <!-- ÙØ±Ù… ÙÛŒÙ„ØªØ± -->
  <form method="get" class="bg-white p-6 rounded-xl shadow-md mb-8 flex flex-wrap justify-center gap-4">
    <input type="text" name="q" placeholder="Ù†Ø§Ù… Ú©ØªØ§Ø¨ ÛŒØ§ Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡"
           value="{{ request.GET.q }}"
           class="px-4 py-2 border rounded-lg w-64">

    <input type="number" step="0.01" name="min_price" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Ù‚ÛŒÙ…Øª"
           value="{{ request.GET.min_price }}"
           class="px-4 py-2 border rounded-lg w-32">

    <input type="number" step="0.01" name="max_price" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø± Ù‚ÛŒÙ…Øª"
           value="{{ request.GET.max_price }}"
           class="px-4 py-2 border rounded-lg w-32">

    <select name="category" class="px-4 py-2 border rounded-lg">
      <option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</option>
      {% for cat in categories %}
        <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == selected_category %}selected{% endif %}>
          {{ cat.name }}
        </option>
      {% endfor %}
    </select>

    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg">ğŸ” ÙÛŒÙ„ØªØ±</button>
    <a href="{% url 'book_list' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-5 py-2 rounded-lg">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±</a>
  </form>

  <!-- Ø¬Ø¯ÙˆÙ„ Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ -->
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white rounded-xl shadow-md overflow-hidden">
      <thead class="bg-green-600 text-white">
        <tr>
          <th class="px-4 py-3">Ø±Ø¯ÛŒÙ</th>
          <th class="px-4 py-3">Ø¹Ù†ÙˆØ§Ù†</th>
          <th class="px-4 py-3">Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡</th>
          <th class="px-4 py-3">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
          <th class="px-4 py-3">Ù‚ÛŒÙ…Øª</th>
          <th class="px-4 py-3">ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ´Ø§Ø±</th>
          <th class="px-4 py-3">Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 text-center">
        {% for book in books %}
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ forloop.counter }}</td>
            <td class="px-4 py-3">{{ book.title }}</td>
            <td class="px-4 py-3">{{ book.author }}</td>
            <td class="px-4 py-3">
              {% if book.category %} {{ book.category.name }} {% else %} - {% endif %}
            </td>
            <td class="px-4 py-3">{{ book.price }} ØªÙˆÙ…Ø§Ù†</td>
            <td class="px-4 py-3">{{ book.publish_date }}</td>
            <td class="px-4 py-3 flex justify-center gap-2">
              <a href="{% url 'edit_book' book.id %}" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg">ğŸ–‰ ÙˆÛŒØ±Ø§ÛŒØ´</a>
              <a href="{% url 'delete_book' book.id %}" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg"
                 onclick="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ú©ØªØ§Ø¨ Ø­Ø°Ù Ø´ÙˆØ¯ØŸ');">ğŸ—‘ï¸ Ø­Ø°Ù</a>
              <a href="{% url 'toggle_favorite' book.id %}" class="bg-pink-500 hover:bg-pink-600 text-white px-3 py-1 rounded-lg">
                {% if book in request.user.userprofile.favorite_books.all %}
                  â¤ï¸
                {% else %}
                  â™¡
                {% endif %}
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" class="px-4 py-3 text-gray-500">Ù‡ÛŒÚ† Ú©ØªØ§Ø¨ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</body>
</html>
